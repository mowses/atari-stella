<!DOCTYPE HTML>
<html lang="en">

<head>
  <title>GECKOS.io</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="shortcut icon" href="#">

  <script src="./geckos.io-client.1.7.2.min.js"></script>
  <script src="./colors/ntsc.js"></script>
  <script type="text/javascript">
    function get_random_color() {
        return {
            r: Math.random() * 256 << 0,
            g: Math.random() * 256 << 0,
            b: Math.random() * 256 << 0,
            a: Math.random() * 256 << 0,
        };
    }

    function random_colors(total)
    {
        var colors = [];
        for (var i = 0; i < total; i++) {
            colors[i] = get_random_color();
        }
        return colors;
    }
    var colors = ntsc_colors;
    var output = '0:0,8:130,160:0,168:130,320:0,328:130,480:0,488:130,640:0,648:130,800:0,808:130,960:0,968:130,1120:0,1128:130,1280:0,1288:130,1440:0,1448:130,1600:0,1608:130,1760:0,1768:130,1920:0,1928:130,2080:0,2088:130,2240:0,2248:130,2400:0,2408:130,2560:0,2568:130,2720:0,2728:130,2880:0,2888:130,3040:0,3048:130,3200:0,3208:130,3360:0,3368:130,3520:0,3528:130,3680:0,3688:130,3840:0,3848:130,4000:0,4008:130,4160:0,4168:130,4320:0,4328:130,4480:0,4488:130,4640:0,4648:130,4800:0,4808:130,4960:0,4968:130,5120:0,5128:130,5280:0,5288:130,5440:0,5448:130,5600:0,5608:130,5760:0,5768:130,5920:0,5928:130,6080:0,6088:130,6240:0,6248:130,6400:0,6408:130,6560:0,6568:130,6720:0,6728:130,6880:0,6888:130,7040:0,7048:130,7200:0,7208:130,7360:0,7368:130,7520:0,7528:130,7680:0,7688:130,7840:0,7848:130,8000:0,8008:130,8160:0,8168:130,8320:0,8328:130,8480:0,8488:130,8640:0,8648:130,8800:0,8808:130,8960:0,8968:130,9006:20,9010:130,9120:0,9128:130,9164:20,9172:130,9240:20,9244:130,9280:0,9288:130,9322:20,9334:130,9338:20,9342:130,9398:20,9410:130,9440:0,9448:130,9480:20,9504:130,9552:20,9572:130,9600:0,9608:130,9638:20,9666:130,9710:20,9734:130,9760:0,9768:130,9796:20,9828:130,9868:20,9896:130,9920:0,9928:192,10080:0,10088:192,10167:2,10168:192,10240:0,10248:192,10327:2,10328:192,10400:0,10408:192,10487:2,10489:192,10560:0,10568:192,10646:2,10647:192,10648:2,10649:192,10720:0,10728:192,10806:2,10807:192,10809:2,10810:192,10880:0,10888:192,10966:2,10967:192,10969:2,10970:192,11040:0,11048:192,11125:2,11126:192,11130:2,11131:192,11200:0,11208:192,11285:2,11286:192,11290:2,11291:192,11360:0,11368:192,11445:2,11446:192,11450:2,11451:192,11520:0,11528:192,11604:2,11605:192,11611:2,11612:192,11680:0,11688:192,11764:2,11765:192,11771:2,11772:192,11840:0,11848:192,11923:2,11924:192,11932:2,11933:192,12000:0,12008:192,12083:2,12084:192,12092:2,12093:192,12160:0,12168:192,12242:2,12243:192,12253:2,12254:192,12320:0,12328:192,12401:2,12402:192,12414:2,12415:192,12480:0,12488:192,12561:2,12562:192,12574:2,12575:192,12640:0,12648:192,12720:2,12721:192,12735:2,12736:192,12800:0,12808:192,12879:2,12880:192,12895:2,12896:192,12960:0,12968:192,13039:2,13040:192,13056:2,13057:192,13120:0,13128:192,13198:2,13199:192,13216:2,13217:192,13280:0,13288:192,13358:2,13359:192,13377:2,13378:192,13440:0,13448:192,13517:2,13518:192,13537:2,13538:192,13600:0,13608:192,13677:2,13678:192,13698:2,13699:192,13760:0,13768:192,13836:2,13837:192,13858:2,13859:192,13920:0,13928:192,13996:2,13997:192,14019:2,14020:192,14080:0,14088:192,14155:2,14156:192,14179:2,14180:192,14240:0,14248:192,14315:2,14316:192,14340:2,14341:192,14400:0,14408:192,14474:2,14475:192,14500:2,14501:192,14560:0,14568:192,14634:2,14635:192,14661:2,14662:192,14720:0,14728:192,14793:2,14794:192,14821:2,14822:192,14880:0,14888:192,14953:2,14954:192,14982:2,14983:192,15040:0,15048:192,15112:2,15113:192,15142:2,15143:192,15200:0,15208:192,15272:2,15273:192,15303:2,15304:192,15360:0,15368:192,15431:2,15432:192,15463:2,15464:192,15520:0,15528:192,15591:4,15592:192,15624:4,15625:192,15680:0,15688:192,15750:4,15751:192,15784:4,15785:192,15840:0,15848:192,15910:4,15911:192,15945:4,15946:192,16000:0,16008:192,16069:4,16070:192,16105:4,16106:192,16160:0,16168:192,16229:4,16230:192,16266:4,16267:192,16320:0,16328:192,16388:4,16389:192,16426:4,16427:192,16480:0,16488:192,16548:4,16549:192,16587:4,16588:192,16640:0,16648:192,16707:4,16708:192,16747:4,16748:192,16800:0,16808:192,16867:4,16868:192,16908:4,16909:192,16960:0,16968:192,17026:4,17027:192,17068:4,17069:192,17120:0,17128:192,17186:4,17187:192,17229:4,17230:192,17280:0,17288:192,17345:4,17346:192,17389:4,17390:192,17440:0,17448:192,17505:6,17506:192,17550:6,17551:192,17600:0,17608:192,17664:6,17665:192,17710:6,17711:192,17760:0,17768:192,17824:6,17825:192,17871:6,17872:192,17920:0,17928:192,17983:6,17984:192,18031:6,18032:192,18080:0,18088:192,18143:6,18144:192,18192:6,18193:192,18240:0,18248:192,18302:6,18303:192,18352:6,18353:192,18400:0,18408:192,18462:6,18463:192,18513:6,18514:192,18560:0,18568:192,18621:6,18622:192,18673:6,18674:192,18720:0,18728:192,18781:6,18782:192,18834:6,18835:192,18880:0,18888:192,18940:6,18941:192,18994:6,18995:192,19040:0,19048:192,19100:6,19101:192,19155:6,19156:192,19200:0,19208:192,19259:6,19260:192,19315:6,19316:192,19360:0,19368:192,19419:6,19420:192,19476:6,19477:192,19520:0,19528:192,19578:6,19579:192,19636:6,19637:192,19680:0,19688:192,19738:6,19739:192,19797:6,19798:192,19840:0,19848:192,19897:6,19898:192,19957:6,19958:192,20000:0,20008:192,20057:6,20058:192,20118:6,20119:192,20160:0,20168:192,20216:6,20217:192,20278:6,20279:192,20320:0,20328:192,20376:10,20377:192,20439:10,20440:192,20480:0,20488:192,20535:10,20536:192,20599:10,20600:192,20640:0,20648:192,20695:10,20696:192,20760:10,20761:192,20800:0,20808:192,20854:10,20855:192,20920:10,20921:192,20960:0,20968:192,21014:10,21015:192,21081:10,21082:192,21120:0,21128:192,21173:10,21174:192,21241:10,21242:192,21280:0,21288:192,21333:10,21334:192,21402:10,21403:192,21440:0,21448:192,21492:10,21493:192,21562:10,21563:192,21600:0,21608:192,21652:10,21653:192,21723:10,21724:192,21760:0,21768:192,21811:10,21812:192,21883:10,21884:192,21920:0,21928:192,21971:10,21972:192,22044:10,22045:192,22080:0,22088:192,22130:10,22131:192,22204:10,22205:192,22240:0,22248:192,22290:10,22291:192,22365:10,22366:192,22400:0,22408:192,22449:10,22450:192,22525:10,22526:192,22560:0,22568:192,22609:10,22610:192,22686:10,22687:192,22720:0,22728:192,22768:10,22769:192,22846:10,22847:192,22880:0,22888:192,22928:10,22929:192,23007:10,23008:192,23040:0,23048:192,23087:10,23088:192,23167:10,23168:192,23200:0,23208:192,23247:10,23248:192,23328:10,23329:192,23360:0,23368:192,23406:10,23407:192,23488:10,23489:192,23520:0,23528:192,23566:10,23567:192,23649:10,23650:192,23680:0,23688:192,23725:10,23726:192,23809:10,23810:192,23840:0,23848:192,23885:10,23886:192,23970:10,23971:192,24000:0,24008:192,24044:10,24045:192,24130:10,24131:192,24160:0,24168:192,24204:10,24205:192,24291:10,24292:192,24320:0,24328:192,24363:10,24364:192,24451:10,24452:192,24480:0,24488:192,24523:10,24524:192,24612:10,24613:192,24640:0,24648:192,24682:10,24683:192,24719:10,24721:192,24723:10,24727:192,24729:10,24731:192,24772:10,24773:192,24800:0,24808:192,24842:10,24843:192,24879:10,24891:192,24933:10,24934:192,24960:0,24968:192,25001:10,25002:192,25039:10,25051:192,25093:10,25094:192,25120:0,25128:192,25161:10,25162:192,25199:10,25201:192,25203:10,25207:192,25211:10,25213:192,25254:10,25255:192,25280:0,25288:192,25320:10,25321:192,25357:10,25359:192,25361:10,25371:192,25414:10,25415:192,25440:0,25448:192,25480:10,25481:192,25519:10,25529:192,25531:10,25533:192,25575:10,25576:192,25600:0,25608:192,25639:10,25640:192,25677:10,25679:192,25681:10,25691:192,25735:10,25736:192,25760:0,25768:192,25799:10,25800:192,25839:10,25849:192,25851:10,25853:192,25896:10,25897:192,25920:0,25928:192,25958:10,25959:192,25997:10,25999:192,26001:10,26011:192,26056:10,26057:192,26080:0,26088:192,26118:10,26119:192,26159:10,26169:192,26171:10,26173:192,26217:10,26218:192,26240:0,26248:192,26277:10,26278:192,26317:10,26319:192,26323:10,26327:192,26329:10,26331:192,26377:10,26378:192,26400:0,26408:192,26437:10,26438:192,26538:10,26539:192,26560:0,27568:66,27632:0,27728:66,27792:0,27888:66,27952:0,28048:66,28056:40,28096:0,28099:40,28101:0,28104:66,28112:0,28208:66,28216:40,28226:0,28230:40,28234:0,28238:40,28242:0,28246:40,28250:0,28254:40,28256:0,28259:40,28261:0,28264:66,28272:0,28368:66,28376:40,28385:0,28387:40,28389:0,28391:40,28393:0,28395:40,28397:0,28399:40,28401:0,28403:40,28405:0,28407:40,28409:0,28411:40,28413:0,28415:40,28416:0,28419:40,28421:0,28424:66,28432:0,28528:66,28536:40,28545:0,28547:40,28549:0,28551:40,28553:0,28555:40,28557:0,28559:40,28561:0,28563:40,28565:0,28567:40,28569:0,28571:40,28573:0,28575:40,28576:0,28578:40,28582:0,28584:66,28592:0,28688:66,28696:40,28705:0,28707:40,28709:0,28711:40,28713:0,28715:40,28717:0,28719:40,28721:0,28723:40,28725:0,28727:40,28729:0,28731:40,28733:0,28735:40,28736:0,28744:66,28752:0,28848:66,28856:40,28865:0,28867:40,28869:0,28871:40,28873:0,28875:40,28877:0,28879:40,28881:0,28883:40,28885:0,28887:40,28889:0,28891:40,28893:0,28895:40,28896:0,28898:40,28902:0,28904:66,28912:0,29008:66,29016:40,29025:0,29027:40,29029:0,29031:40,29033:0,29035:40,29037:0,29039:40,29041:0,29043:40,29045:0,29047:40,29049:0,29051:40,29053:0,29055:40,29056:0,29057:40,29059:0,29061:40,29063:0,29064:66,29072:0,29168:66,29176:40,29186:0,29190:40,29194:0,29198:40,29202:0,29206:40,29210:0,29214:40,29216:0,29217:40,29219:0,29221:40,29223:0,29224:66,29232:0,29328:66,29336:40,29376:0,29377:40,29379:0,29381:40,29383:0,29384:66,29392:0,29488:66,29552:0,29648:66,29712:0,29808:66,29872:0,29968:66,30032:0,30128:66,30192:0,30288:66,30352:0,30448:66,30456:40,30464:66,30472:40,30504:66,30512:0,30608:66,30616:40,30619:0,30621:40,30624:66,30632:40,30633:0,30634:40,30638:0,30639:40,30642:0,30646:40,30650:0,30654:40,30658:0,30662:40,30664:66,30672:0,30768:66,30776:40,30778:0,30781:40,30784:66,30792:40,30793:0,30799:40,30801:0,30802:40,30805:0,30807:40,30809:0,30811:40,30813:0,30815:40,30817:0,30819:40,30821:0,30823:40,30824:66,30832:0,30928:66,30936:40,30939:0,30941:40,30944:66,30952:40,30953:0,30954:40,30955:0,30957:40,30958:0,30959:40,30965:0,30967:40,30969:0,30971:40,30973:0,30975:40,30977:0,30979:40,30981:0,30983:40,30984:66,30992:0,31088:66,31096:40,31099:0,31101:40,31104:66,31112:40,31115:0,31117:40,31122:0,31126:40,31129:0,31131:40,31133:0,31135:40,31137:0,31139:40,31141:0,31143:40,31144:66,31152:0,31248:66,31256:40,31259:0,31261:40,31264:66,31272:40,31273:0,31274:40,31275:0,31277:40,31278:0,31279:40,31281:0,31283:40,31289:0,31291:40,31293:0,31295:40,31297:0,31299:40,31301:0,31303:40,31304:66,31312:0,31408:66,31416:40,31419:0,31421:40,31424:66,31432:40,31433:0,31439:40,31441:0,31443:40,31449:0,31451:40,31453:0,31455:40,31457:0,31459:40,31461:0,31463:40,31464:66,31472:0,31568:66,31576:40,31578:0,31582:40,31584:66,31592:40,31593:0,31594:40,31595:0,31597:40,31598:0,31599:40,31601:0,31607:40,31610:0,31614:40,31618:0,31622:40,31624:66,31632:0,31728:66,31736:40,31744:66,31752:40,31784:66,31792:0,31888:66,31952:0,32048:66,32112:0,32208:66,32272:0,33140:68,33160:12,33161:0,33162:12,33170:0,33174:12,33181:0,33300:38,33319:12,33321:0,33325:12,33326:0,33329:12,33330:0,33333:12,33335:0,33460:38,33478:12,33481:0,33482:12,33484:0,33485:12,33486:0,33487:12,33488:0,33489:12,33490:0,33492:12,33494:0,33496:12,33499:0,33500:12,33501:0,33502:12,33505:0,33506:12,33507:0,33509:12,33510:0,33620:26,33637:12,33639:0,33640:12,33641:0,33642:12,33643:0,33645:12,33646:0,33647:12,33648:0,33649:12,33650:0,33651:12,33653:0,33654:12,33655:0,33656:12,33657:0,33660:12,33661:0,33662:12,33663:0,33664:12,33665:0,33666:12,33668:0,33669:12,33670:0,33780:214,33796:12,33801:0,33802:12,33803:0,33805:12,33806:0,33807:12,33808:0,33809:12,33812:0,33814:12,33815:0,33816:12,33819:0,33820:12,33821:0,33822:12,33823:0,33824:12,33825:0,33826:12,33830:0,33940:214,33955:12,33957:0,33960:12,33961:0,33962:12,33963:0,33965:12,33966:0,33967:12,33968:0,33969:12,33971:0,33974:12,33975:0,33978:12,33979:0,33980:12,33981:0,33982:12,33983:0,33984:12,33985:0,33986:12,33987:0,33988:12,33990:0,34100:132,34114:12,34116:0,34120:12,34121:0,34122:12,34124:0,34125:12,34126:0,34127:12,34128:0,34129:12,34130:0,34134:12,34135:0,34136:12,34139:0,34140:12,34141:0,34142:12,34145:0,34146:12,34147:0,34149:12,34150:0,';
  </script>
  <style>
    body {
        padding: 0px;
        margin: 0px;
    }
    #enduro {
        /*width: 100%;
        height: 100%;*/
    }
  </style>
</head>
<body>

  <canvas id="enduro" width="160" height="228"></canvas>
  <audio src="http://localhost:2001/php-audio.php" type='audio/webm; codecs="vorbis"' controls preload="none"></audio>

  <!-- <audio controls>
    <source src="http://localhost:2001/php-audio.php" type="audio/mp3">
  </audio> -->
  <script>
    var canvas = document.getElementById('enduro');
    var ctx = canvas.getContext('2d', { alpha: false });
    var pixels_image = ctx.getImageData(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = '#000000';

    function render(output)
    {
        const _pixels_image = pixels_image;
        const _ctx = ctx;
        const _output = output;
        const _colors = colors;
        const _width = _pixels_image.width;
        const _height = _pixels_image.height;

        var pixels = _pixels_image.data;
        var last;

        for (let y = 0; y < _height; y++) {
            for (let x = 0; x < _width; x++) {
                let index = x + y * _width;
                let output_index = _output[index];
                
                if (output_index === undefined) {
                    // missing pixel
                    output_index = last;
                }

                let offset = index * 4;
                let color = _colors[output_index];

                if (color === undefined) {
                  console.log('undefined color', index, output_index, last, _output);
                  return;
                }
                
                pixels[offset] = color.r;
                pixels[offset + 1] = color.g;
                pixels[offset + 2] = color.b;
                pixels[offset + 3] = color.a;
                last = output_index;
            }
        }
        
        _ctx.putImageData(_pixels_image, 0, 0);
    }

    // setInterval(function() {
    //     colors = random_colors(255);
    //     var _output = JSON.parse('{' + output.replaceAll(/(\d+)\:/ig, '"$1":') + '"end":true}');
    //     render(_output);
    // }, 1000);
  </script>
  <script src="./app-geckos-client.js"></script>
  <script type="text/javascript">
    // abaixo funcionou
    // window.addEventListener('load', function () {
    //     var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    //     var source = audioCtx.createBufferSource();
    //     var xhr = new XMLHttpRequest();
    //     xhr.open('GET', 'php-audio.php');
    //     xhr.responseType = 'arraybuffer';
    //     xhr.addEventListener('load', function (r) {
    //         audioCtx.decodeAudioData(
    //                 xhr.response, 
    //                 function (buffer) {
    //                     source.buffer = buffer;
    //                     source.connect(audioCtx.destination);
    //                     source.loop = false;
    //                 });
    //         source.start(0);
    //     });
    //     xhr.send();
    // });
  </script>
</body>
</html>